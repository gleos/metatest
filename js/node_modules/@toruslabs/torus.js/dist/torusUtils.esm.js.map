{"version":3,"file":"torusUtils.esm.js","sources":["../src/loglevel.js","../src/some.js","../src/utils.js","../src/torus.js"],"sourcesContent":["import loglevel from 'loglevel'\n\nconst log = loglevel.getLogger('torus.js')\nlog.disableAll()\n\nexport default log\n","function capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nexport class SomeError extends Error {\n  constructor({ errors, responses, predicate }) {\n    super('Unable to resolve enough promises.')\n    this.errors = errors\n    this.responses = responses\n    this.predicate = predicate\n  }\n}\n\nexport const Some = (promises, predicate) =>\n  new Promise((resolve, reject) => {\n    let finishedCount = 0\n    const sharedState = { resolved: false }\n    const errorArr = new Array(promises.length).fill(undefined)\n    const resultArr = new Array(promises.length).fill(undefined)\n    let predicateError\n    promises.forEach((x, index) => {\n      x.then((resp) => {\n        resultArr[index] = resp\n        return undefined\n      })\n        .catch((error) => {\n          errorArr[index] = error\n        })\n        .finally(() => {\n          if (sharedState.resolved) return\n          predicate(resultArr.slice(0), sharedState)\n            .then((data) => {\n              sharedState.resolved = true\n              resolve(data)\n              return undefined\n            })\n            .catch((error) => {\n              // log only the last predicate error\n              predicateError = error\n            })\n            .finally((_) => {\n              finishedCount += 1\n              if (finishedCount === promises.length) {\n                const errors = Object.values(\n                  resultArr.reduce((acc, z) => {\n                    const { id, error } = z || {}\n                    if (error?.data?.length > 0) {\n                      if (error.data.startsWith('Error occurred while verifying params')) acc[id] = capitalizeFirstLetter(error.data)\n                      else acc[id] = error.data\n                    }\n                    return acc\n                  }, {})\n                )\n\n                if (errors.length > 0) {\n                  // Format-able errors\n                  const msg = errors.length > 1 ? `\\n${errors.map((it) => `â€¢ ${it}`).join('\\n')}` : errors[0]\n                  reject(new Error(msg))\n                } else {\n                  reject(\n                    new SomeError({\n                      errors: errorArr,\n                      responses: resultArr,\n                      predicate: predicateError?.message || predicateError,\n                    })\n                  )\n                }\n              }\n            })\n        })\n    })\n  })\n","import { generateJsonRPCObject, post } from '@toruslabs/http-helpers'\nimport JsonStringify from 'json-stable-stringify'\n\nimport log from './loglevel'\nimport { Some } from './some'\n\nexport class GetOrSetNonceError extends Error {}\n\nexport const kCombinations = (s, k) => {\n  let set = s\n  if (typeof set === 'number') {\n    set = Array.from({ length: set }, (_, i) => i)\n  }\n  if (k > set.length || k <= 0) {\n    return []\n  }\n\n  if (k === set.length) {\n    return [set]\n  }\n\n  if (k === 1) {\n    return set.reduce((acc, cur) => [...acc, [cur]], [])\n  }\n\n  const combs = []\n  let tailCombs = []\n\n  for (let i = 0; i <= set.length - k + 1; i += 1) {\n    tailCombs = kCombinations(set.slice(i + 1), k - 1)\n    for (let j = 0; j < tailCombs.length; j += 1) {\n      combs.push([set[i], ...tailCombs[j]])\n    }\n  }\n\n  return combs\n}\n\nexport const thresholdSame = (arr, t) => {\n  const hashMap = {}\n  for (let i = 0; i < arr.length; i += 1) {\n    const str = JsonStringify(arr[i])\n    hashMap[str] = hashMap[str] ? hashMap[str] + 1 : 1\n    if (hashMap[str] === t) {\n      return arr[i]\n    }\n  }\n  return undefined\n}\n\nexport const keyLookup = async (endpoints, verifier, verifierId) => {\n  const lookupPromises = endpoints.map((x) =>\n    post(\n      x,\n      generateJsonRPCObject('VerifierLookupRequest', {\n        verifier,\n        verifier_id: verifierId.toString(),\n      })\n    ).catch((err) => log.error('lookup request failed', err))\n  )\n  return Some(lookupPromises, (lookupResults) => {\n    const lookupShares = lookupResults.filter((x1) => x1)\n    const errorResult = thresholdSame(\n      lookupShares.map((x2) => x2 && x2.error),\n      ~~(endpoints.length / 2) + 1\n    )\n    const keyResult = thresholdSame(\n      lookupShares.map((x3) => x3 && x3.result),\n      ~~(endpoints.length / 2) + 1\n    )\n    if (keyResult || errorResult) {\n      return Promise.resolve({ keyResult, errorResult })\n    }\n    return Promise.reject(new Error(`invalid results ${JSON.stringify(lookupResults)}`))\n  })\n}\n\nexport const waitKeyLookup = (endpoints, verifier, verifierId, timeout) =>\n  new Promise((resolve, reject) => {\n    setTimeout(() => {\n      keyLookup(endpoints, verifier, verifierId).then(resolve).catch(reject)\n    }, timeout)\n  })\n\nexport const keyAssign = async (endpoints, torusNodePubs, lastPoint, firstPoint, verifier, verifierId) => {\n  let nodeNum\n  let initialPoint\n  if (lastPoint === undefined) {\n    nodeNum = Math.floor(Math.random() * endpoints.length)\n    initialPoint = nodeNum\n  } else {\n    nodeNum = lastPoint % endpoints.length\n  }\n  if (nodeNum === firstPoint) throw new Error('Looped through all')\n  if (firstPoint !== undefined) initialPoint = firstPoint\n\n  const data = generateJsonRPCObject('KeyAssign', {\n    verifier,\n    verifier_id: verifierId.toString(),\n  })\n  try {\n    const signedData = await post(\n      'https://signer.tor.us/api/sign',\n      data,\n      {\n        headers: {\n          pubKeyX: torusNodePubs[nodeNum].X,\n          pubKeyY: torusNodePubs[nodeNum].Y,\n        },\n      },\n      { useAPIKey: true }\n    )\n    return post(\n      endpoints[nodeNum],\n      { ...data, ...signedData },\n      {\n        headers: {\n          'Content-Type': 'application/json; charset=utf-8',\n        },\n      }\n    )\n  } catch (error) {\n    log.error(error)\n    return keyAssign(endpoints, torusNodePubs, nodeNum + 1, initialPoint, verifier, verifierId)\n  }\n}\n","import { decrypt, generatePrivate, getPublic } from '@toruslabs/eccrypto'\nimport { generateJsonRPCObject, get, post, setAPIKey, setEmbedHost } from '@toruslabs/http-helpers'\nimport BN from 'bn.js'\nimport { ec as EC } from 'elliptic'\nimport stringify from 'json-stable-stringify'\nimport memoryCache from 'memory-cache'\nimport { keccak256, toChecksumAddress } from 'web3-utils'\n\nimport log from './loglevel'\nimport { Some } from './some'\nimport { GetOrSetNonceError, kCombinations, keyAssign, keyLookup, thresholdSame, waitKeyLookup } from './utils'\n\n// Implement threshold logic wrappers around public APIs\n// of Torus nodes to handle malicious node responses\nclass Torus {\n  constructor({\n    enableOneKey = false,\n    metadataHost = 'https://metadata.tor.us',\n    allowHost = 'https://signer.tor.us/api/allow',\n    serverTimeOffset = 0,\n  } = {}) {\n    this.ec = new EC('secp256k1')\n    this.metadataHost = metadataHost\n    this.allowHost = allowHost\n    this.metadataCache = memoryCache\n    this.metadataLock = {}\n    this.enableOneKey = enableOneKey\n    this.serverTimeOffset = serverTimeOffset || 0 // ms\n  }\n\n  static enableLogging(v = true) {\n    if (v) log.enableAll()\n    else log.disableAll()\n  }\n\n  static setAPIKey(apiKey) {\n    setAPIKey(apiKey)\n  }\n\n  static setEmbedHost(embedHost) {\n    setEmbedHost(embedHost)\n  }\n\n  /**\n   * Note: use this function only for openlogin tkey account lookups.\n   */\n  async getUserTypeAndAddress(endpoints, torusNodePubs, { verifier, verifierId }, doesKeyAssign = false) {\n    const { keyResult, errorResult } = (await keyLookup(endpoints, verifier, verifierId)) || {}\n    let isNewKey = false\n    let finalKeyResult\n    if (errorResult && JSON.stringify(errorResult).includes('Verifier + VerifierID has not yet been assigned')) {\n      if (!doesKeyAssign) {\n        throw new Error('Verifier + VerifierID has not yet been assigned')\n      }\n      await keyAssign(endpoints, torusNodePubs, undefined, undefined, verifier, verifierId)\n      const assignResult = (await waitKeyLookup(endpoints, verifier, verifierId, 1000)) || {}\n      finalKeyResult = assignResult.keyResult\n      isNewKey = true\n    } else if (keyResult) {\n      finalKeyResult = keyResult\n    } else {\n      throw new Error(`node results do not match at first lookup ${JSON.stringify(keyResult || {})}, ${JSON.stringify(errorResult || {})}`)\n    }\n    if (finalKeyResult) {\n      const { pub_key_X: X, pub_key_Y: Y } = finalKeyResult.keys[0]\n      let typeOfUser\n      let nonce\n      let pubNonce\n      let modifiedPubKey\n      let upgraded\n\n      try {\n        ;({ typeOfUser, nonce, pubNonce, upgraded } = await this.getOrSetNonce(X, Y, undefined, !isNewKey))\n        nonce = new BN(nonce || '0', 16)\n      } catch {\n        throw new GetOrSetNonceError()\n      }\n      if (typeOfUser === 'v1') {\n        modifiedPubKey = this.ec\n          .keyFromPublic({ x: X.toString(16), y: Y.toString(16) })\n          .getPublic()\n          .add(this.ec.keyFromPrivate(nonce.toString(16)).getPublic())\n      } else if (typeOfUser === 'v2') {\n        modifiedPubKey = this.ec\n          .keyFromPublic({ x: X.toString(16), y: Y.toString(16) })\n          .getPublic()\n          .add(this.ec.keyFromPublic({ x: pubNonce.x, y: pubNonce.y }).getPublic())\n      } else {\n        throw new Error('getOrSetNonce should always return typeOfUser.')\n      }\n      const finalX = modifiedPubKey.getX().toString(16)\n      const finalY = modifiedPubKey.getY().toString(16)\n      const address = this.generateAddressFromPubKey(modifiedPubKey.getX(), modifiedPubKey.getY())\n      return { typeOfUser, nonce, pubNonce, upgraded, X: finalX, Y: finalY, address }\n    }\n    throw new Error(`node results do not match at final lookup ${JSON.stringify(keyResult || {})}, ${JSON.stringify(errorResult || {})}`)\n  }\n\n  async setCustomKey({ privKeyHex, metadataNonce, torusKeyHex, customKeyHex }) {\n    let torusKey\n    if (torusKeyHex) {\n      torusKey = new BN(torusKeyHex, 16)\n    } else {\n      const privKey = new BN(privKeyHex, 16)\n      torusKey = privKey.sub(metadataNonce).umod(this.ec.curve.n)\n    }\n    const customKey = new BN(customKeyHex, 16)\n    const newMetadataNonce = customKey.sub(torusKey).umod(this.ec.curve.n)\n    const data = this.generateMetadataParams(newMetadataNonce.toString(16), torusKey.toString(16))\n    await this.setMetadata(data)\n  }\n\n  async retrieveShares(endpoints, indexes, verifier, verifierParams, idToken, extraParams = {}) {\n    const promiseArr = []\n    await get(\n      this.allowHost,\n      {\n        headers: {\n          verifier,\n          verifier_id: verifierParams.verifier_id,\n        },\n      },\n      { useAPIKey: true }\n    )\n    /*\n      CommitmentRequestParams struct {\n        MessagePrefix      string `json:\"messageprefix\"`\n        TokenCommitment    string `json:\"tokencommitment\"`\n        TempPubX           string `json:\"temppubx\"`\n        TempPubY           string `json:\"temppuby\"`\n        VerifierIdentifier string `json:\"verifieridentifier\"`\n      } \n      */\n\n    // generate temporary private and public key that is used to secure receive shares\n    const tmpKey = generatePrivate()\n    const pubKey = getPublic(tmpKey).toString('hex')\n    const pubKeyX = pubKey.slice(2, 66)\n    const pubKeyY = pubKey.slice(66)\n    const tokenCommitment = keccak256(idToken)\n\n    // make commitment requests to endpoints\n    for (let i = 0; i < endpoints.length; i += 1) {\n      const p = post(\n        endpoints[i],\n        generateJsonRPCObject('CommitmentRequest', {\n          messageprefix: 'mug00',\n          tokencommitment: tokenCommitment.slice(2),\n          temppubx: pubKeyX,\n          temppuby: pubKeyY,\n          verifieridentifier: verifier,\n        })\n      ).catch((err) => log.error('commitment', err))\n      promiseArr.push(p)\n    }\n    /*\n      ShareRequestParams struct {\n        Item []bijson.RawMessage `json:\"item\"`\n      }\n      ShareRequestItem struct {\n        IDToken            string          `json:\"idtoken\"`\n        NodeSignatures     []NodeSignature `json:\"nodesignatures\"`\n        VerifierIdentifier string          `json:\"verifieridentifier\"`\n      }\n      NodeSignature struct {\n        Signature   string\n        Data        string\n        NodePubKeyX string\n        NodePubKeyY string\n      }\n      CommitmentRequestResult struct {\n        Signature string `json:\"signature\"`\n        Data      string `json:\"data\"`\n        NodePubX  string `json:\"nodepubx\"`\n        NodePubY  string `json:\"nodepuby\"`\n      }\n      */\n    // send share request once k + t number of commitment requests have completed\n    return Some(promiseArr, (resultArr) => {\n      const completedRequests = resultArr.filter((x) => {\n        if (!x || typeof x !== 'object') {\n          return false\n        }\n        if (x.error) {\n          return false\n        }\n        return true\n      })\n      if (completedRequests.length >= ~~(endpoints.length / 4) * 3 + 1) {\n        return Promise.resolve(resultArr)\n      }\n      return Promise.reject(new Error(`invalid ${JSON.stringify(resultArr)}`))\n    }).then((responses) => {\n      const promiseArrRequest = []\n      const nodeSigs = []\n      for (let i = 0; i < responses.length; i += 1) {\n        if (responses[i]) nodeSigs.push(responses[i].result)\n      }\n      for (let i = 0; i < endpoints.length; i += 1) {\n        // eslint-disable-next-line promise/no-nesting\n        const p = post(\n          endpoints[i],\n          generateJsonRPCObject('ShareRequest', {\n            encrypted: 'yes',\n            item: [{ ...verifierParams, idtoken: idToken, nodesignatures: nodeSigs, verifieridentifier: verifier, ...extraParams }],\n          })\n        ).catch((err) => log.error('share req', err))\n        promiseArrRequest.push(p)\n      }\n      return Some(promiseArrRequest, async (shareResponses, sharedState) => {\n        /*\n              ShareRequestResult struct {\n                Keys []KeyAssignment\n              }\n                      / KeyAssignmentPublic -\n              type KeyAssignmentPublic struct {\n                Index     big.Int\n                PublicKey common.Point\n                Threshold int\n                Verifiers map[string][]string // Verifier => VerifierID\n              }\n\n              // KeyAssignment -\n              type KeyAssignment struct {\n                KeyAssignmentPublic\n                Share big.Int // Or Si\n              }\n            */\n        // check if threshold number of nodes have returned the same user public key\n        const completedRequests = shareResponses.filter((x) => x)\n        const thresholdPublicKey = thresholdSame(\n          shareResponses.map((x) => x && x.result && x.result.keys[0].PublicKey),\n          ~~(endpoints.length / 2) + 1\n        )\n        // optimistically run lagrange interpolation once threshold number of shares have been received\n        // this is matched against the user public key to ensure that shares are consistent\n        if (completedRequests.length >= ~~(endpoints.length / 2) + 1 && thresholdPublicKey) {\n          const sharePromises = []\n          const nodeIndex = []\n          for (let i = 0; i < shareResponses.length; i += 1) {\n            if (shareResponses[i] && shareResponses[i].result && shareResponses[i].result.keys && shareResponses[i].result.keys.length > 0) {\n              shareResponses[i].result.keys.sort((a, b) => new BN(a.Index, 16).cmp(new BN(b.Index, 16)))\n              if (shareResponses[i].result.keys[0].Metadata) {\n                const metadata = {\n                  ephemPublicKey: Buffer.from(shareResponses[i].result.keys[0].Metadata.ephemPublicKey, 'hex'),\n                  iv: Buffer.from(shareResponses[i].result.keys[0].Metadata.iv, 'hex'),\n                  mac: Buffer.from(shareResponses[i].result.keys[0].Metadata.mac, 'hex'),\n                  mode: Buffer.from(shareResponses[i].result.keys[0].Metadata.mode, 'hex'),\n                }\n                sharePromises.push(\n                  // eslint-disable-next-line promise/no-nesting\n                  decrypt(tmpKey, {\n                    ...metadata,\n                    ciphertext: Buffer.from(atob(shareResponses[i].result.keys[0].Share).padStart(64, '0'), 'hex'),\n                  }).catch((err) => log.debug('share decryption', err))\n                )\n              } else {\n                sharePromises.push(Promise.resolve(Buffer.from(shareResponses[i].result.keys[0].Share.padStart(64, '0'), 'hex')))\n              }\n            } else {\n              sharePromises.push(Promise.resolve(undefined))\n            }\n            nodeIndex.push(new BN(indexes[i], 16))\n          }\n          const sharesResolved = await Promise.all(sharePromises)\n          if (sharedState.resolved) return undefined\n\n          const decryptedShares = sharesResolved.reduce((acc, curr, index) => {\n            if (curr) acc.push({ index: nodeIndex[index], value: new BN(curr) })\n            return acc\n          }, [])\n          // run lagrange interpolation on all subsets, faster in the optimistic scenario than berlekamp-welch due to early exit\n          const allCombis = kCombinations(decryptedShares.length, ~~(endpoints.length / 2) + 1)\n          let privateKey\n          for (let j = 0; j < allCombis.length; j += 1) {\n            const currentCombi = allCombis[j]\n            const currentCombiShares = decryptedShares.filter((v, index) => currentCombi.includes(index))\n            const shares = currentCombiShares.map((x) => x.value)\n            const indices = currentCombiShares.map((x) => x.index)\n            const derivedPrivateKey = this.lagrangeInterpolation(shares, indices)\n            const decryptedPubKey = getPublic(Buffer.from(derivedPrivateKey.toString(16, 64), 'hex')).toString('hex')\n            const decryptedPubKeyX = decryptedPubKey.slice(2, 66)\n            const decryptedPubKeyY = decryptedPubKey.slice(66)\n            if (\n              new BN(decryptedPubKeyX, 16).cmp(new BN(thresholdPublicKey.X, 16)) === 0 &&\n              new BN(decryptedPubKeyY, 16).cmp(new BN(thresholdPublicKey.Y, 16)) === 0\n            ) {\n              privateKey = derivedPrivateKey\n              break\n            }\n          }\n          if (privateKey === undefined) {\n            throw new Error('could not derive private key')\n          }\n\n          let metadataNonce\n          if (this.enableOneKey) {\n            const { nonce } = await this.getNonce(thresholdPublicKey.X, thresholdPublicKey.Y, privateKey)\n            metadataNonce = new BN(nonce || '0', 16)\n          } else {\n            metadataNonce = await this.getMetadata({ pub_key_X: thresholdPublicKey.X, pub_key_Y: thresholdPublicKey.Y })\n          }\n          log.debug('> torus.js/retrieveShares', { privKey: privateKey.toString(16), metadataNonce: metadataNonce.toString(16) })\n\n          if (sharedState.resolved) return undefined\n          privateKey = privateKey.add(metadataNonce).umod(this.ec.curve.n)\n\n          const ethAddress = this.generateAddressFromPrivKey(privateKey)\n          log.debug('> torus.js/retrieveShares', { ethAddress, privKey: privateKey.toString(16) })\n\n          // return reconstructed private key and ethereum address\n          return {\n            ethAddress,\n            privKey: privateKey.toString('hex', 64),\n            metadataNonce,\n          }\n        }\n        throw new Error('invalid')\n      })\n    })\n  }\n\n  async getMetadata(data, options) {\n    let unlock\n    try {\n      const dataKey = stringify(data)\n      if (this.metadataLock[dataKey] !== null) {\n        await this.metadataLock[dataKey]\n      } else {\n        this.metadataLock[dataKey] = new Promise((resolve) => {\n          unlock = () => {\n            this.metadataLock[dataKey] = null\n            resolve()\n          }\n        })\n      }\n      const cachedResult = this.metadataCache.get(dataKey)\n      if (cachedResult !== null) {\n        if (unlock) unlock()\n        return cachedResult\n      }\n      const metadataResponse = await post(`${this.metadataHost}/get`, data, options, { useAPIKey: true })\n      if (!metadataResponse || !metadataResponse.message) {\n        this.metadataCache.put(dataKey, new BN(0), 60000)\n        if (unlock) unlock()\n        return new BN(0)\n      }\n      this.metadataCache.put(dataKey, new BN(metadataResponse.message, 16), 60000)\n      return new BN(metadataResponse.message, 16) // nonce\n    } catch (error) {\n      log.error('get metadata error', error)\n      if (unlock) unlock()\n      return new BN(0)\n    }\n  }\n\n  generateMetadataParams(message, privateKey) {\n    const key = this.ec.keyFromPrivate(privateKey.toString('hex', 64))\n    const setData = {\n      data: message,\n      timestamp: new BN(~~(this.serverTimeOffset + Date.now() / 1000)).toString(16),\n    }\n    const sig = key.sign(keccak256(stringify(setData)).slice(2))\n    return {\n      pub_key_X: key.getPublic().getX().toString('hex'),\n      pub_key_Y: key.getPublic().getY().toString('hex'),\n      set_data: setData,\n      signature: Buffer.from(sig.r.toString(16, 64) + sig.s.toString(16, 64) + new BN(sig.v).toString(16, 2), 'hex').toString('base64'),\n    }\n  }\n\n  async setMetadata(data, options) {\n    try {\n      this.metadataCache.del(stringify({ pub_key_X: data.pub_key_X, pub_key_Y: data.pub_key_Y }))\n      const metadataResponse = await post(`${this.metadataHost}/set`, data, options, { useAPIKey: true })\n      return metadataResponse.message // IPFS hash\n    } catch (error) {\n      log.error('set metadata error', error)\n      return ''\n    }\n  }\n\n  lagrangeInterpolation(shares, nodeIndex) {\n    if (shares.length !== nodeIndex.length) {\n      return null\n    }\n    let secret = new BN(0)\n    for (let i = 0; i < shares.length; i += 1) {\n      let upper = new BN(1)\n      let lower = new BN(1)\n      for (let j = 0; j < shares.length; j += 1) {\n        if (i !== j) {\n          upper = upper.mul(nodeIndex[j].neg())\n          upper = upper.umod(this.ec.curve.n)\n          let temp = nodeIndex[i].sub(nodeIndex[j])\n          temp = temp.umod(this.ec.curve.n)\n          lower = lower.mul(temp).umod(this.ec.curve.n)\n        }\n      }\n      let delta = upper.mul(lower.invm(this.ec.curve.n)).umod(this.ec.curve.n)\n      delta = delta.mul(shares[i]).umod(this.ec.curve.n)\n      secret = secret.add(delta)\n    }\n    return secret.umod(this.ec.curve.n)\n  }\n\n  generateAddressFromPrivKey(privateKey) {\n    const key = this.ec.keyFromPrivate(privateKey.toString('hex', 64), 'hex')\n    const publicKey = key.getPublic().encode('hex').slice(2)\n    const ethAddressLower = `0x${keccak256(Buffer.from(publicKey, 'hex')).slice(64 - 38)}`\n    return toChecksumAddress(ethAddressLower)\n  }\n\n  generateAddressFromPubKey(publicKeyX, publicKeyY) {\n    const key = this.ec.keyFromPublic({ x: publicKeyX.toString('hex', 64), y: publicKeyY.toString('hex', 64) })\n    const publicKey = key.getPublic().encode('hex').slice(2)\n    const ethAddressLower = `0x${keccak256(Buffer.from(publicKey, 'hex')).slice(64 - 38)}`\n    return toChecksumAddress(ethAddressLower)\n  }\n\n  /**\n   * Note: use this function only with custom auth, don't use to lookup openlogin accounts.\n   */\n  async getPublicAddress(endpoints, torusNodePubs, { verifier, verifierId }, isExtended = false) {\n    log.debug('> torus.js/getPublicAddress', { endpoints, torusNodePubs, verifier, verifierId, isExtended })\n\n    let finalKeyResult\n    let isNewKey = false\n\n    const { keyResult, errorResult } = (await keyLookup(endpoints, verifier, verifierId)) || {}\n    if (errorResult && JSON.stringify(errorResult).includes('Verifier + VerifierID has not yet been assigned')) {\n      await keyAssign(endpoints, torusNodePubs, undefined, undefined, verifier, verifierId)\n      const assignResult = (await waitKeyLookup(endpoints, verifier, verifierId, 1000)) || {}\n      finalKeyResult = assignResult.keyResult\n      isNewKey = true\n    } else if (keyResult) {\n      finalKeyResult = keyResult\n    } else {\n      throw new Error(`node results do not match at first lookup ${JSON.stringify(keyResult || {})}, ${JSON.stringify(errorResult || {})}`)\n    }\n    log.debug('> torus.js/getPublicAddress', { finalKeyResult, isNewKey })\n\n    if (finalKeyResult) {\n      let { pub_key_X: X, pub_key_Y: Y } = finalKeyResult.keys[0]\n      let typeOfUser\n      let nonce\n      let pubNonce\n      let modifiedPubKey\n      if (this.enableOneKey) {\n        let upgraded\n        try {\n          ;({ typeOfUser, nonce, pubNonce, upgraded } = await this.getOrSetNonce(X, Y, undefined, !isNewKey))\n          nonce = new BN(nonce || '0', 16)\n        } catch {\n          throw new GetOrSetNonceError()\n        }\n        if (typeOfUser === 'v1') {\n          modifiedPubKey = this.ec\n            .keyFromPublic({ x: X.toString(16), y: Y.toString(16) })\n            .getPublic()\n            .add(this.ec.keyFromPrivate(nonce.toString(16)).getPublic())\n        } else if (typeOfUser === 'v2') {\n          if (upgraded) {\n            // OneKey is upgraded to 2/n, returned address is address of Torus key (postbox key), not tKey\n            modifiedPubKey = this.ec.keyFromPublic({ x: X.toString(16), y: Y.toString(16) }).getPublic()\n          } else {\n            modifiedPubKey = this.ec\n              .keyFromPublic({ x: X.toString(16), y: Y.toString(16) })\n              .getPublic()\n              .add(this.ec.keyFromPublic({ x: pubNonce.x, y: pubNonce.y }).getPublic())\n          }\n        } else {\n          throw new Error('getOrSetNonce should always return typeOfUser.')\n        }\n      } else {\n        typeOfUser = 'v1'\n        nonce = await this.getMetadata({ pub_key_X: X, pub_key_Y: Y })\n        modifiedPubKey = this.ec\n          .keyFromPublic({ x: X.toString(16), y: Y.toString(16) })\n          .getPublic()\n          .add(this.ec.keyFromPrivate(nonce.toString(16)).getPublic())\n      }\n\n      X = modifiedPubKey.getX().toString(16)\n      Y = modifiedPubKey.getY().toString(16)\n\n      const address = this.generateAddressFromPubKey(modifiedPubKey.getX(), modifiedPubKey.getY())\n      log.debug('> torus.js/getPublicAddress', { X, Y, address, typeOfUser, nonce: nonce?.toString(16), pubNonce })\n\n      if (!isExtended) return address\n      return {\n        typeOfUser,\n        address,\n        X,\n        Y,\n        metadataNonce: nonce,\n        pubNonce,\n      }\n    }\n    throw new Error(`node results do not match at final lookup ${JSON.stringify(keyResult || {})}, ${JSON.stringify(errorResult || {})}`)\n  }\n\n  /**\n   * Internal functions for OneKey (OpenLogin v2), only call these functions if you know what you're doing\n   */\n\n  static isGetOrSetNonceError(err) {\n    return err instanceof GetOrSetNonceError\n  }\n\n  async getOrSetNonce(X, Y, privKey, getOnly = false) {\n    let data\n    const msg = getOnly ? 'getNonce' : 'getOrSetNonce'\n    if (privKey) {\n      data = this.generateMetadataParams(msg, privKey)\n    } else {\n      data = {\n        pub_key_X: X,\n        pub_key_Y: Y,\n        set_data: { data: msg },\n      }\n    }\n    return post(`${this.metadataHost}/get_or_set_nonce`, data, undefined, { useAPIKey: true })\n  }\n\n  async getNonce(X, Y, privKey) {\n    return this.getOrSetNonce(X, Y, privKey, true)\n  }\n\n  getPostboxKeyFrom1OutOf1(privKey, nonce) {\n    const privKeyBN = new BN(privKey, 16)\n    const nonceBN = new BN(nonce, 16)\n    return privKeyBN.sub(nonceBN).umod(this.ec.curve.n).toString('hex')\n  }\n}\n\nexport default Torus\n"],"names":["log","loglevel","getLogger","disableAll","capitalizeFirstLetter","str","charAt","toUpperCase","slice","SomeError","errors","responses","predicate","Error","Some","promises","Promise","resolve","reject","finishedCount","sharedState","resolved","errorArr","Array","length","fill","undefined","resultArr","predicateError","forEach","x","index","then","resp","catch","error","finally","data","_","Object","values","reduce","acc","z","id","startsWith","msg","map","it","join","message","GetOrSetNonceError","kCombinations","s","k","set","from","i","cur","combs","tailCombs","j","push","thresholdSame","arr","t","hashMap","JsonStringify","keyLookup","endpoints","verifier","verifierId","lookupPromises","post","generateJsonRPCObject","verifier_id","toString","err","lookupResults","lookupShares","filter","x1","errorResult","x2","keyResult","x3","result","JSON","stringify","waitKeyLookup","timeout","setTimeout","keyAssign","torusNodePubs","lastPoint","firstPoint","nodeNum","Math","floor","random","initialPoint","headers","pubKeyX","X","pubKeyY","Y","useAPIKey","signedData","Torus","enableOneKey","metadataHost","allowHost","serverTimeOffset","ec","EC","metadataCache","memoryCache","metadataLock","doesKeyAssign","isNewKey","includes","assignResult","finalKeyResult","keys","pub_key_X","pub_key_Y","getOrSetNonce","typeOfUser","nonce","pubNonce","upgraded","BN","modifiedPubKey","keyFromPublic","y","getPublic","add","keyFromPrivate","finalX","getX","finalY","getY","address","generateAddressFromPubKey","privKeyHex","metadataNonce","torusKeyHex","customKeyHex","torusKey","privKey","sub","umod","curve","n","customKey","newMetadataNonce","generateMetadataParams","setMetadata","indexes","verifierParams","idToken","extraParams","promiseArr","get","tmpKey","generatePrivate","pubKey","tokenCommitment","keccak256","p","messageprefix","tokencommitment","temppubx","temppuby","verifieridentifier","completedRequests","promiseArrRequest","nodeSigs","encrypted","item","idtoken","nodesignatures","shareResponses","thresholdPublicKey","PublicKey","sharePromises","nodeIndex","sort","a","b","Index","cmp","Metadata","metadata","ephemPublicKey","Buffer","iv","mac","mode","decrypt","ciphertext","atob","Share","padStart","debug","all","sharesResolved","decryptedShares","curr","value","allCombis","currentCombi","currentCombiShares","v","shares","indices","derivedPrivateKey","lagrangeInterpolation","decryptedPubKey","decryptedPubKeyX","decryptedPubKeyY","privateKey","getNonce","getMetadata","ethAddress","generateAddressFromPrivKey","options","dataKey","unlock","cachedResult","metadataResponse","put","key","setData","timestamp","Date","now","sig","sign","set_data","signature","r","del","secret","upper","lower","mul","neg","temp","delta","invm","publicKey","encode","ethAddressLower","toChecksumAddress","publicKeyX","publicKeyY","isExtended","getOnly","privKeyBN","nonceBN","enableAll","apiKey","setAPIKey","embedHost","setEmbedHost"],"mappings":"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"}